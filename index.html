<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Landscape Assessment">
    <meta name="theme-color" content="#16a34a">
    <title>Idaho Landscaping Assessment Tool v4.8</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
        #loading {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #16a34a 0%, #15803d 100%);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: white; z-index: 9999;
        }
        .loader {
            border: 4px solid rgba(255, 255, 255, 0.3); border-radius: 50%;
            border-top: 4px solid white; width: 50px; height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="loading">
        <div class="loader"></div>
        <h2 style="margin-top: 2rem; font-size: 1.5rem; font-weight: bold;">Loading Assessment Tool...</h2>
        <p style="margin-top: 0.5rem; font-size: 0.9rem; opacity: 0.9;">v4.8 - Professional Reports + Task Classification</p>
    </div>
    <div id="root"></div>

    <script>
        const { useState, useEffect, useRef, createElement: h } = React;
        
        // Icons
        const Camera = ({ size = 24 }) => h('svg', { 
            width: size, height: size, viewBox: '0 0 24 24', fill: 'none', 
            stroke: 'currentColor', strokeWidth: '2', style: { display: 'inline-block', verticalAlign: 'middle' }
        }, [
            h('path', { key: 'p1', d: 'M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z' }),
            h('circle', { key: 'c1', cx: '12', cy: '13', r: '4' })
        ]);
        
        const Plus = ({ size = 20 }) => h('svg', {
            width: size, height: size, viewBox: '0 0 24 24', fill: 'none',
            stroke: 'currentColor', strokeWidth: '2', style: { display: 'inline-block', verticalAlign: 'middle' }
        }, [
            h('line', { key: 'l1', x1: '12', y1: '5', x2: '12', y2: '19' }),
            h('line', { key: 'l2', x1: '5', y1: '12', x2: '19', y2: '12' })
        ]);

        const Download = ({ size = 20 }) => h('svg', {
            width: size, height: size, viewBox: '0 0 24 24', fill: 'none',
            stroke: 'currentColor', strokeWidth: '2', style: { display: 'inline-block', verticalAlign: 'middle' }
        }, [
            h('path', { key: 'p1', d: 'M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4' }),
            h('polyline', { key: 'p2', points: '7 10 12 15 17 10' }),
            h('line', { key: 'l1', x1: '12', y1: '15', x2: '12', y2: '3' })
        ]);

        const Share = ({ size = 20 }) => h('svg', {
            width: size, height: size, viewBox: '0 0 24 24', fill: 'none',
            stroke: 'currentColor', strokeWidth: '2', style: { display: 'inline-block', verticalAlign: 'middle' }
        }, [
            h('circle', { key: 'c1', cx: '18', cy: '5', r: '3' }),
            h('circle', { key: 'c2', cx: '6', cy: '12', r: '3' }),
            h('circle', { key: 'c3', cx: '18', cy: '19', r: '3' }),
            h('line', { key: 'l1', x1: '8.59', y1: '13.51', x2: '15.42', y2: '17.49' }),
            h('line', { key: 'l2', x1: '15.41', y1: '6.51', x2: '8.59', y2: '10.49' })
        ]);

        const AlertCircle = ({ size = 20 }) => h('svg', {
            width: size, height: size, viewBox: '0 0 24 24', fill: 'none',
            stroke: 'currentColor', strokeWidth: '2', style: { display: 'inline-block', verticalAlign: 'middle' }
        }, [
            h('circle', { key: 'c1', cx: '12', cy: '12', r: '10' }),
            h('line', { key: 'l1', x1: '12', y1: '8', x2: '12', y2: '12' }),
            h('line', { key: 'l2', x1: '12', y1: '16', x2: '12.01', y2: '16' })
        ]);

        // PWA v4.8: Professional Reports + Task Classification
        // - Fixed PDF encoding (no emoji/special chars)
        // - Client-focused Executive Summary
        // - DIY vs Professional task classification
        // - Time estimates for homeowner tasks
        const PLANTS = {
            'Antelope Bitterbrush': { native: true, type: 'Deciduous Shrub', water: 'Low', sun: 'Full sun', zone: '4', scientificName: 'Purshia tridentata' },
            'Apache Plume': { native: true, type: 'Deciduous Shrub', water: 'Low', sun: 'Full sun', zone: '4', scientificName: 'Fallugia paradoxa' },
            'Arborvitae': { native: false, type: 'Evergreen Shrub', water: 'Moderate', sun: 'Full sun to partial shade', zone: '3-6' },
            'Arrowleaf Balsamroot': { native: true, type: 'Perennial', water: 'Low', sun: 'Full sun', zone: '3', scientificName: 'Balsamorhiza sagittata' },
            'Autumn Blaze Maple': { native: false, type: 'Deciduous Tree', water: 'Moderate', sun: 'Full sun', zone: '3-8', scientificName: 'Acer x freemanii' },
            'Bearberry (Kinnikinnick)': { native: true, type: 'Evergreen Groundcover', water: 'Low', sun: 'Partial shade', zone: '2-6' },
            'Big Sagebrush': { native: true, type: 'Evergreen Shrub', water: 'Low', sun: 'Full sun', zone: '5', scientificName: 'Artemisia tridentata' },
            'Big-tooth Maple': { native: true, type: 'Deciduous Tree', water: 'Moderate', sun: 'Full sun to partial shade', zone: '4', scientificName: 'Acer grandidentatum' },
            'Bigtooth Maple': { native: true, type: 'Deciduous Tree', water: 'Moderate', sun: 'Full sun to partial shade', zone: '4-6' },
            'Birch-leaf Mt Mahogany': { native: true, type: 'Deciduous Shrub', water: 'Low', sun: 'Full sun', zone: '4', scientificName: 'Cercocarpus montanus' },
            'Bitter Cherry': { native: true, type: 'Deciduous Shrub', water: 'Low to moderate', sun: 'Full sun to partial shade', zone: '4', scientificName: 'Prunus emarginata' },
            'Bitterbrush': { native: true, type: 'Deciduous Shrub', water: 'Very low', sun: 'Full sun', zone: '4-6' },
            'Black Cottonwood': { native: true, type: 'Deciduous Tree', water: 'Moderate to high', sun: 'Full sun', zone: '3', scientificName: 'Populus trichocarpa' },
            'Black-eyed Susan': { native: false, type: 'Perennial', water: 'Low to moderate', sun: 'Full sun', zone: '3-6' },
            'Blanket Flower': { native: true, type: 'Perennial', water: 'Low to moderate', sun: 'Full sun', zone: '2', scientificName: 'Gaillardia aristata' },
            'Bloodgood Japanese Maple': { native: false, type: 'Deciduous Tree', water: 'Moderate', sun: 'Full sun to partial shade', zone: '5-9', scientificName: 'Acer palmatum' },
            'Blue Camas': { native: true, type: 'Perennial', water: 'Moderate', sun: 'Full sun to partial shade', zone: '4', scientificName: 'Camassia quamash' },
            'Blue Elderberry': { native: true, type: 'Deciduous Shrub', water: 'Moderate to high', sun: 'Full sun to partial shade', zone: '3', scientificName: 'Sambucus caerulea' },
            'Blue Fescue': { native: false, type: 'Ornamental Grass', water: 'Low', sun: 'Full sun', zone: '4-6' },
            'Blue Grama': { native: true, type: 'Ornamental Grass', water: 'Very low', sun: 'Full sun', zone: '3', scientificName: 'Bouteloua gracilis' },
            'Blue Spruce': { native: true, type: 'Evergreen Tree', water: 'Moderate', sun: 'Full sun to partial shade', zone: '3', scientificName: 'Picea pungens' },
            'Bluebunch Wheatgrass': { native: true, type: 'Ornamental Grass', water: 'Low', sun: 'Full sun', zone: '4', scientificName: 'Pseudoroegneria spicata' },
            'Bottlebrush Squirreltail': { native: true, type: 'Ornamental Grass', water: 'Very low', sun: 'Full sun', zone: '3', scientificName: 'Elymus elymoides' },
            'Boxwood': { native: false, type: 'Evergreen Shrub', water: 'Moderate', sun: 'Partial shade', zone: '5-6' },
            'Bristlecone Pine': { native: true, type: 'Evergreen Tree', water: 'Low', sun: 'Full sun', zone: '4-6' },
            'Buffalograss': { native: true, type: 'Ornamental Grass', water: 'Low', sun: 'Full sun', zone: '4', scientificName: 'Buchloe dactyloides' },
            'Capital Flowering Pear': { native: false, type: 'Deciduous Tree', water: 'Moderate', sun: 'Full sun', zone: '5-9', scientificName: 'Pyrus calleryana' },
            'Cardinal Royal Mountain Ash': { native: false, type: 'Deciduous Tree', water: 'Moderate', sun: 'Full sun to partial shade', zone: '3-6', scientificName: 'Sorbus aucuparia' },
            'Chanticleer Flowering Pear': { native: false, type: 'Deciduous Tree', water: 'Moderate', sun: 'Full sun', zone: '4-8', scientificName: 'Pyrus calleryana' },
            'Chief Joseph Lodgepole Pine': { native: false, type: 'Evergreen Conifer', water: 'Low to moderate', sun: 'Full sun', zone: '5-8', scientificName: 'Pinus contorta' },
            'Chokecherry': { native: true, type: 'Deciduous Shrub', water: 'Moderate', sun: 'Full sun', zone: '2-6' },
            'Cimmaron Ash': { native: false, type: 'Deciduous Tree', water: 'Moderate', sun: 'Full sun', zone: '3-7', scientificName: 'Fraxinus pennsylvanica' },
            'Colorado Blue Columbine': { native: true, type: 'Perennial', water: 'Moderate', sun: 'Partial shade', zone: '2', scientificName: 'Aquilegia caerulea' },
            'Coneflower (Echinacea)': { native: false, type: 'Perennial', water: 'Low to moderate', sun: 'Full sun', zone: '3-6' },
            'Creeping Oregon Grape': { native: true, type: 'Evergreen Groundcover', water: 'Low', sun: 'Partial shade to shade', zone: '5-6' },
            'Curl-leaf Mountain Mahogany': { native: true, type: 'Evergreen Shrub', water: 'Low', sun: 'Full sun to partial shade', zone: '4', scientificName: 'Cercocarpus ledifolius' },
            'Cut-leaf Daisy': { native: true, type: 'Perennial', water: 'Low', sun: 'Full sun', zone: '3', scientificName: 'Erigeron compositus' },
            'Daylily': { native: false, type: 'Perennial', water: 'Moderate', sun: 'Full sun to partial shade', zone: '3-6' },
            'Desert Fernbush': { native: true, type: 'Deciduous Shrub', water: 'Low', sun: 'Full sun', zone: '5-6' },
            'Desert Globemallow': { native: true, type: 'Perennial', water: 'Low', sun: 'Full sun', zone: '6', scientificName: 'Sphaeralcea ambigua' },
            'Douglas Fir': { native: true, type: 'Evergreen Tree', water: 'Moderate', sun: 'Full sun to partial shade', zone: '4-6' },
            'Douglas Hawthorn': { native: true, type: 'Small Tree', water: 'Moderate', sun: 'Full sun', zone: '4-6' },
            'Emperor I Japanese Maple': { native: false, type: 'Deciduous Tree', water: 'Moderate', sun: 'Full sun to partial shade', zone: '5-9', scientificName: 'Acer palmatum' },
            'Engelmann Spruce': { native: true, type: 'Evergreen Tree', water: 'Moderate', sun: 'Full sun', zone: '2-6' },
            'Fat Albert Blue Spruce': { native: false, type: 'Evergreen Conifer', water: 'Moderate', sun: 'Full sun', zone: '2-8', scientificName: 'Picea pungens' },
            'Fern Bush': { native: true, type: 'Deciduous Shrub', water: 'Low', sun: 'Full sun', zone: '4', scientificName: 'Chamaebatiaria millefolium' },
            'Forsythia': { native: false, type: 'Deciduous Shrub', water: 'Moderate', sun: 'Full sun', zone: '5-6' },
            'Four-wing Saltbush': { native: true, type: 'Evergreen Shrub', water: 'Very low', sun: 'Full sun', zone: '4', scientificName: 'Atriplex canescens' },
            'Fringed Sagebrush': { native: true, type: 'Perennial', water: 'Low', sun: 'Full sun', zone: '4', scientificName: 'Artemisia frigida' },
            'Golden Currant': { native: true, type: 'Deciduous Shrub', water: 'Moderate', sun: 'Full sun to partial shade', zone: '4-6' },
            'Goldenrod': { native: true, type: 'Perennial', water: 'Moderate', sun: 'Full sun', zone: '1', scientificName: 'Solidago spp.' },
            'Great Basin Wildrye': { native: true, type: 'Ornamental Grass', water: 'Low', sun: 'Full sun', zone: '3', scientificName: 'Leymus cinereus' },
            'Green Rabbitbrush': { native: true, type: 'Evergreen Shrub', water: 'Very low', sun: 'Full sun', zone: '3', scientificName: 'Chrysothamnus viscidiflorus' },
            'Greenleaf Manzanita': { native: true, type: 'Evergreen Shrub', water: 'Low', sun: 'Full sun to partial shade', zone: '5-6' },
            'Hosta': { native: false, type: 'Perennial', water: 'Moderate to high', sun: 'Shade to partial shade', zone: '3-6' },
            'Hydrangea': { native: false, type: 'Deciduous Shrub', water: 'Moderate to high', sun: 'Partial shade', zone: '5-6' },
            'Idaho Fescue': { native: true, type: 'Ornamental Grass', water: 'Low to moderate', sun: 'Full sun to partial shade', zone: '4', scientificName: 'Festuca idahoensis' },
            'Indian Ricegrass': { native: true, type: 'Ornamental Grass', water: 'Low', sun: 'Full sun', zone: '4-5', scientificName: 'Oryzopsis hymenoides' },
            'Japanese Maple': { native: false, type: 'Deciduous Tree', water: 'Moderate', sun: 'Partial shade', zone: '5-6' },
            'Karl Foerster Feather Reed Grass': { native: false, type: 'Ornamental Grass', water: 'Moderate', sun: 'Full sun to partial shade', zone: '5-6' },
            'Kinnikinnick': { native: true, type: 'Evergreen Groundcover', water: 'Low', sun: 'Full sun to partial shade', zone: '1', scientificName: 'Arctostaphylos uva-ursi' },
            'Lavender': { native: false, type: 'Perennial', water: 'Low', sun: 'Full sun', zone: '5-6' },
            'Lilac': { native: false, type: 'Deciduous Shrub', water: 'Moderate', sun: 'Full sun', zone: '3-6' },
            'Limber Pine': { native: true, type: 'Evergreen Tree', water: 'Moderate', sun: 'Full sun', zone: '3-6' },
            'Little Bluestem': { native: true, type: 'Ornamental Grass', water: 'Low', sun: 'Full sun', zone: '4', scientificName: 'Andropogon scoparium' },
            'Louisiana Sage': { native: true, type: 'Perennial', water: 'Low', sun: 'Full sun', zone: '5', scientificName: 'Artemisia ludoviciana' },
            'Maiden Grass': { native: false, type: 'Ornamental Grass', water: 'Moderate', sun: 'Full sun', zone: '5-6' },
            'Missouri Evening Primrose': { native: true, type: 'Perennial', water: 'Low to moderate', sun: 'Full sun', zone: '4', scientificName: 'Oenothera missouriensis' },
            'Mormon Tea': { native: true, type: 'Evergreen Shrub', water: 'Very low', sun: 'Full sun', zone: '5', scientificName: 'Ephedra viridis' },
            'Mountain Mahogany': { native: true, type: 'Evergreen Shrub', water: 'Very low', sun: 'Full sun', zone: '4-6' },
            'Narrowleaf Yucca': { native: true, type: 'Perennial', water: 'Low', sun: 'Full sun to partial shade', zone: '3', scientificName: 'Yucca glauca' },
            'Netleaf Hackberry': { native: true, type: 'Deciduous Tree', water: 'Low', sun: 'Full sun', zone: '5-6' },
            'Ninebark': { native: true, type: 'Deciduous Shrub', water: 'Moderate', sun: 'Full sun to partial shade', zone: '3', scientificName: 'Physocarpus malvaceus' },
            'Oakleaf Sumac': { native: true, type: 'Deciduous Shrub', water: 'Low to moderate', sun: 'Full sun', zone: '3', scientificName: 'Rhus trilobata' },
            'Ocean Spray': { native: true, type: 'Deciduous Shrub', water: 'Moderate', sun: 'Full sun to partial shade', zone: '5-6' },
            'Parry\'s Agave': { native: true, type: 'Perennial', water: 'Low', sun: 'Full sun', zone: '4', scientificName: 'Agave parryi' },
            'Pearly Everlasting': { native: true, type: 'Perennial', water: 'Moderate', sun: 'Full sun to partial shade', zone: '4', scientificName: 'Anaphalis margaritacea' },
            'Penstemon': { native: true, type: 'Perennial', water: 'Low to moderate', sun: 'Full sun', zone: '2-5', scientificName: 'Penstemon spp.' },
            'Pinyon Pine': { native: true, type: 'Evergreen Tree', water: 'Very low', sun: 'Full sun', zone: '5-6' },
            'Ponderosa Pine': { native: true, type: 'Evergreen Tree', water: 'Moderate', sun: 'Full sun', zone: '3-6' },
            'Potentilla': { native: false, type: 'Deciduous Shrub', water: 'Low to moderate', sun: 'Full sun', zone: '2-6' },
            'Prairie Smoke': { native: true, type: 'Perennial', water: 'Moderate', sun: 'Full sun', zone: '2', scientificName: 'Geum triflorum' },
            'Prickly Pear Cactus': { native: true, type: 'Succulent', water: 'Very low', sun: 'Full sun', zone: '5', scientificName: 'Opuntia spp.' },
            'Prince\'s Plume': { native: true, type: 'Perennial', water: 'Low', sun: 'Full sun', zone: '4', scientificName: 'Stanleya pinnata' },
            'Purple Coneflower': { native: true, type: 'Perennial', water: 'Low to moderate', sun: 'Full sun', zone: '3', scientificName: 'Echinacea purpurea' },
            'Pussytoes': { native: true, type: 'Perennial', water: 'Low to moderate', sun: 'Full sun to partial shade', zone: '2', scientificName: 'Antennaria spp.' },
            'Quaking Aspen': { native: true, type: 'Deciduous Tree', water: 'Moderate to high', sun: 'Full sun', zone: '1-6' },
            'Red-flowering Currant': { native: true, type: 'Deciduous Shrub', water: 'Moderate', sun: 'Full sun to partial shade', zone: '4', scientificName: 'Ribes sanguineum' },
            'Red-osier Dogwood': { native: true, type: 'Deciduous Shrub', water: 'Moderate to high', sun: 'Full sun to partial shade', zone: '2', scientificName: 'Cornus stolonifera' },
            'Redstem Ceanothus': { native: true, type: 'Deciduous Shrub', water: 'Moderate', sun: 'Full sun to partial shade', zone: '5-6' },
            'Rocky Mountain Ash': { native: true, type: 'Deciduous Tree', water: 'Moderate', sun: 'Full sun to partial shade', zone: '4', scientificName: 'Sorbus scopulina' },
            'Rocky Mountain Juniper': { native: true, type: 'Evergreen Tree', water: 'Low', sun: 'Full sun', zone: '3-6' },
            'Rocky Mountain Maple': { native: true, type: 'Deciduous Tree', water: 'Moderate', sun: 'Full sun to partial shade', zone: '4-6' },
            'Rubber Rabbitbrush': { native: true, type: 'Deciduous Shrub', water: 'Low', sun: 'Full sun', zone: '4-6' },
            'Russet Buffaloberry': { native: true, type: 'Deciduous Shrub', water: 'Low to moderate', sun: 'Full sun to partial shade', zone: '2', scientificName: 'Shepherdia canadensis' },
            'Russian Sage': { native: false, type: 'Perennial', water: 'Low', sun: 'Full sun', zone: '4-6' },
            'Sand Dropseed': { native: true, type: 'Ornamental Grass', water: 'Low', sun: 'Full sun', zone: '4', scientificName: 'Sporobolus cryptandrus' },
            'Saskatoon Serviceberry': { native: true, type: 'Deciduous Shrub', water: 'Moderate', sun: 'Full sun to partial shade', zone: '4', scientificName: 'Amelanchier alnifolia' },
            'Sedum': { native: false, type: 'Perennial', water: 'Low', sun: 'Full sun', zone: '3-6' },
            'Serviceberry': { native: true, type: 'Deciduous Shrub', water: 'Moderate', sun: 'Full sun to partial shade', zone: '2-6' },
            'Shademaster Honeylocust': { native: false, type: 'Deciduous Tree', water: 'Low to moderate', sun: 'Full sun', zone: '5-8', scientificName: 'Gleditsia triacanthos' },
            'Shrubby Cinquefoil': { native: true, type: 'Deciduous Shrub', water: 'Moderate', sun: 'Full sun to partial shade', zone: '3', scientificName: 'Potentilla fruticosa' },
            'Silver Buffaloberry': { native: true, type: 'Deciduous Shrub', water: 'Low', sun: 'Full sun', zone: '3', scientificName: 'Shepherdia argentea' },
            'Silver Sagebrush': { native: true, type: 'Evergreen Shrub', water: 'Low', sun: 'Full sun', zone: '4', scientificName: 'Artemisia cana' },
            'Skunkbush Sumac': { native: true, type: 'Deciduous Shrub', water: 'Low', sun: 'Full sun to partial shade', zone: '4', scientificName: 'Rhus trilobata' },
            'Smooth Sumac': { native: true, type: 'Deciduous Shrub', water: 'Low', sun: 'Full sun', zone: '4', scientificName: 'Rhus glabra' },
            'Snowberry': { native: true, type: 'Deciduous Shrub', water: 'Moderate', sun: 'Full sun to shade', zone: '3-6' },
            'Spike Gayfeather': { native: true, type: 'Perennial', water: 'Low to moderate', sun: 'Full sun', zone: '3', scientificName: 'Liatris spicata' },
            'Subalpine Fir': { native: true, type: 'Evergreen Tree', water: 'Moderate to high', sun: 'Full sun to partial shade', zone: '3-6' },
            'Sulfur Flower Buckwheat': { native: true, type: 'Perennial', water: 'Low', sun: 'Full sun', zone: '3', scientificName: 'Eriogonum umbellatum' },
            'Syringa (Mock Orange)': { native: true, type: 'Deciduous Shrub', water: 'Moderate', sun: 'Full sun to partial shade', zone: '4-6' },
            'Tall Oregon Grape': { native: true, type: 'Evergreen Shrub', water: 'Low to moderate', sun: 'Partial shade', zone: '5-6' },
            'Thinleaf Alder': { native: true, type: 'Deciduous Tree', water: 'Moderate to high', sun: 'Full sun to partial shade', zone: '3-6' },
            'Water Birch': { native: true, type: 'Deciduous Tree', water: 'Moderate to high', sun: 'Full sun to partial shade', zone: '3', scientificName: 'Betula occidentalis' },
            'Wax Currant': { native: true, type: 'Deciduous Shrub', water: 'Low', sun: 'Full sun to partial shade', zone: '4', scientificName: 'Ribes cereum' },
            'Weeping Blue Atlas Cedar': { native: false, type: 'Evergreen Conifer', water: 'Moderate', sun: 'Full sun', zone: '6-9', scientificName: 'Cedrus atlantica' },
            'Western Columbine': { native: true, type: 'Perennial', water: 'Moderate', sun: 'Partial shade', zone: '3', scientificName: 'Aquilegia formosa' },
            'Western Juniper': { native: true, type: 'Evergreen Tree', water: 'Very low', sun: 'Full sun', zone: '5-6' },
            'Western White Pine': { native: true, type: 'Evergreen Tree', water: 'Moderate', sun: 'Full sun to partial shade', zone: '4', scientificName: 'Pinus monticola' },
            'Wild Blue Flax': { native: true, type: 'Perennial', water: 'Low', sun: 'Full sun', zone: '3', scientificName: 'Linum lewisii' },
            'Wild Rose': { native: true, type: 'Deciduous Shrub', water: 'Moderate', sun: 'Full sun to partial shade', zone: '4', scientificName: 'Rosa woodsii' },
            'Winterfat': { native: true, type: 'Evergreen Shrub', water: 'Very low', sun: 'Full sun', zone: '4', scientificName: 'Krascheninnikovia lanata' },
            'Woods Rose': { native: true, type: 'Deciduous Shrub', water: 'Moderate', sun: 'Full sun to partial shade', zone: '4', scientificName: 'Rosa woodsii' },
            'Yarrow': { native: true, type: 'Perennial', water: 'Low', sun: 'Full sun', zone: '3', scientificName: 'Achillea millefolium' },
            'Custom Plant': { native: false, type: 'Unknown', water: 'Unknown', sun: 'Unknown', zone: 'Unknown' }
        };

        // v4.8: TASK CLASSIFICATION SYSTEM
        // Determines if tasks are DIY-friendly or require professional help
        const TASK_CLASSIFICATION = {
            // DIY-friendly tasks
            diy: {
                conditions: ['Needs Pruning', 'Drought Stressed', 'Overgrown'],
                types: ['Perennial', 'Ornamental Grass', 'Evergreen Groundcover', 'Succulent'],
                tasks: {
                    'Needs Pruning': { task: 'Light pruning and deadheading', time: '15-30 min per plant' },
                    'Drought Stressed': { task: 'Adjust irrigation schedule', time: '30 min setup' },
                    'Overgrown': { task: 'Cut back and shape', time: '20-45 min per plant' }
                }
            },
            // Professional recommended
            professional: {
                conditions: ['Dead/Dying', 'Diseased', 'Pest Damage', 'Transplant Needed'],
                types: ['Deciduous Tree', 'Evergreen Tree', 'Evergreen Conifer', 'Small Tree'],
                reasons: {
                    'Dead/Dying': 'Safe removal and proper disposal required',
                    'Diseased': 'Proper diagnosis and treatment prevents spread',
                    'Pest Damage': 'Identification and targeted treatment needed',
                    'Transplant Needed': 'Heavy equipment and expertise for success'
                }
            }
        };

        // Replacement suggestions (from v4.7)
        const REPLACEMENT_SUGGESTIONS = {
            'Evergreen Shrub': {
                primary: 'Rocky Mountain Juniper',
                primaryReason: 'Native, extremely drought-tolerant, excellent screening, cold-hardy',
                alternatives: ['Curl-leaf Mountain Mahogany', 'Mountain Mahogany', 'Tall Oregon Grape', 'Green Rabbitbrush']
            },
            'Deciduous Shrub': {
                primary: 'Ninebark',
                primaryReason: 'Native, disease-resistant, colorful foliage, low maintenance',
                alternatives: ['Serviceberry', 'Golden Currant', 'Chokecherry', 'Woods Rose']
            },
            'Deciduous Tree': {
                primary: 'Autumn Blaze Maple',
                primaryReason: 'Fast-growing, brilliant fall color, adaptable to Idaho conditions',
                alternatives: ['Big-tooth Maple', 'Rocky Mountain Maple', 'Netleaf Hackberry', 'Quaking Aspen']
            },
            'Evergreen Tree': {
                primary: 'Ponderosa Pine',
                primaryReason: 'Native, drought-tolerant once established, iconic Idaho tree',
                alternatives: ['Rocky Mountain Juniper', 'Blue Spruce', 'Douglas Fir', 'Pinyon Pine']
            },
            'Perennial': {
                primary: 'Penstemon',
                primaryReason: 'Native, drought-tolerant, pollinator-friendly, long bloom season',
                alternatives: ['Purple Coneflower', 'Blanket Flower', 'Wild Blue Flax', 'Yarrow']
            },
            'Ornamental Grass': {
                primary: 'Idaho Fescue',
                primaryReason: 'Native, low water, excellent texture, deer resistant',
                alternatives: ['Blue Grama', 'Little Bluestem', 'Bluebunch Wheatgrass']
            },
            'Evergreen Groundcover': {
                primary: 'Kinnikinnick',
                primaryReason: 'Native, evergreen, low-maintenance, excellent erosion control',
                alternatives: ['Creeping Oregon Grape', 'Sedum', 'Pussytoes']
            },
            'Unknown': {
                primary: 'Consult with specialist',
                primaryReason: 'Plant type unknown - professional assessment recommended',
                alternatives: ['Ninebark', 'Penstemon', 'Idaho Fescue']
            }
        };

        const SPECIFIC_REPLACEMENTS = {
            'Arborvitae': { primary: 'Rocky Mountain Juniper', reason: 'Native alternative with better drought tolerance and disease resistance', alternatives: ['Curl-leaf Mountain Mahogany', 'Boxwood', 'Tall Oregon Grape'] },
            'Hydrangea': { primary: 'Ninebark', reason: 'Much lower water needs, similar form, native to Idaho', alternatives: ['Serviceberry', 'Ocean Spray', 'Syringa (Mock Orange)'] },
            'Hosta': { primary: 'Wild Blue Flax', reason: 'Better adapted to Idaho sun and lower water needs', alternatives: ['Penstemon', 'Western Columbine'] },
            'Japanese Maple': { primary: 'Big-tooth Maple', reason: 'Native maple with similar aesthetic, better cold hardiness', alternatives: ['Rocky Mountain Maple', 'Bloodgood Japanese Maple'] }
        };

        const LOCATIONS = [
            'Front Yard - North', 'Front Yard - East', 'Front Yard - South', 'Front Yard - West',
            'Backyard - North', 'Backyard - East', 'Backyard - South', 'Backyard - West',
            'Side Yard - North', 'Side Yard - South',
            'Patio Area', 'Garden Bed 1', 'Garden Bed 2', 'Garden Bed 3',
            'Foundation Planting', 'Driveway Border', 'Property Line'
        ];

        const CONDITIONS = [
            'Healthy/Mature', 'Healthy/Young', 'Needs Pruning', 'Overgrown',
            'Drought Stressed', 'Winter Damage', 'Crowded', 'Transplant Needed',
            'Diseased', 'Pest Damage', 'Dead/Dying'
        ];

        const PRIORITY_MAP = {
            'Dead/Dying': { level: 'CRITICAL', color: '#dc2626', timeline: 'Immediate action required' },
            'Diseased': { level: 'CRITICAL', color: '#dc2626', timeline: 'Address within 2 weeks' },
            'Pest Damage': { level: 'CRITICAL', color: '#dc2626', timeline: 'Address within 2 weeks' },
            'Overgrown': { level: 'HIGH', color: '#ea580c', timeline: 'This season' },
            'Crowded': { level: 'HIGH', color: '#ea580c', timeline: 'This season' },
            'Transplant Needed': { level: 'HIGH', color: '#ea580c', timeline: 'This season or next' },
            'Needs Pruning': { level: 'MEDIUM', color: '#ca8a04', timeline: 'Next maintenance cycle' },
            'Drought Stressed': { level: 'MEDIUM', color: '#ca8a04', timeline: 'Adjust watering now' },
            'Winter Damage': { level: 'MEDIUM', color: '#ca8a04', timeline: 'This season' },
            'Healthy/Mature': { level: 'LOW', color: '#16a34a', timeline: 'Routine maintenance' },
            'Healthy/Young': { level: 'LOW', color: '#16a34a', timeline: 'Routine maintenance' }
        };

        const getPriority = (condition) => {
            return PRIORITY_MAP[condition] || { level: 'MEDIUM', color: '#ca8a04', timeline: 'Review needed' };
        };

        const getReplacementSuggestion = (plantName, plantType, condition) => {
            const needsReplacement = ['Dead/Dying', 'Diseased', 'Pest Damage'].includes(condition);
            if (!needsReplacement) return null;
            if (SPECIFIC_REPLACEMENTS[plantName]) return SPECIFIC_REPLACEMENTS[plantName];
            const typeReplacement = REPLACEMENT_SUGGESTIONS[plantType] || REPLACEMENT_SUGGESTIONS['Unknown'];
            return { primary: typeReplacement.primary, reason: typeReplacement.primaryReason, alternatives: typeReplacement.alternatives };
        };

        // v4.8: Classify task as DIY or Professional
        const classifyTask = (plant) => {
            const isTree = ['Deciduous Tree', 'Evergreen Tree', 'Evergreen Conifer', 'Small Tree'].includes(plant.type);
            const isCritical = ['Dead/Dying', 'Diseased', 'Pest Damage'].includes(plant.condition);
            const needsTransplant = plant.condition === 'Transplant Needed';
            
            // Trees almost always need professional help
            if (isTree && plant.condition !== 'Healthy/Mature' && plant.condition !== 'Healthy/Young') {
                return {
                    type: 'professional',
                    reason: isTree ? 'Tree work requires proper equipment and safety training' : TASK_CLASSIFICATION.professional.reasons[plant.condition],
                    task: isCritical ? `Remove and replace ${plant.name}` : `Professional ${plant.condition.toLowerCase()} care for ${plant.name}`
                };
            }
            
            // Critical conditions need professional help
            if (isCritical || needsTransplant) {
                return {
                    type: 'professional',
                    reason: TASK_CLASSIFICATION.professional.reasons[plant.condition] || 'Professional expertise recommended',
                    task: isCritical ? `Treatment/removal of ${plant.name}` : `Transplant ${plant.name}`
                };
            }
            
            // DIY-friendly conditions for non-trees
            if (TASK_CLASSIFICATION.diy.conditions.includes(plant.condition)) {
                const taskInfo = TASK_CLASSIFICATION.diy.tasks[plant.condition];
                return {
                    type: 'diy',
                    task: `${taskInfo.task} - ${plant.name}`,
                    time: taskInfo.time,
                    location: plant.location
                };
            }
            
            // Healthy plants - routine maintenance
            if (plant.condition === 'Healthy/Mature' || plant.condition === 'Healthy/Young') {
                return {
                    type: 'routine',
                    task: `Continue routine care for ${plant.name}`,
                    time: 'Seasonal'
                };
            }
            
            // Default to DIY for medium priority
            return {
                type: 'diy',
                task: `Address ${plant.condition.toLowerCase()} - ${plant.name}`,
                time: '30-60 min',
                location: plant.location
            };
        };

        // Image compression (from v4.7)
        const compressImage = (dataUrl, maxWidth = 1200, quality = 0.7) => {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => {
                    try {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        let width = img.width;
                        let height = img.height;
                        if (width > maxWidth) {
                            height = (height * maxWidth) / width;
                            width = maxWidth;
                        }
                        canvas.width = width;
                        canvas.height = height;
                        ctx.drawImage(img, 0, 0, width, height);
                        resolve(canvas.toDataURL('image/jpeg', quality));
                    } catch (err) { reject(err); }
                };
                img.onerror = () => reject(new Error('Failed to load image'));
                img.src = dataUrl;
            });
        };

        function App() {
            const [step, setStep] = useState('client');
            const [clientInfo, setClientInfo] = useState({ name: '', address: '', city: 'Boise', phone: '', zone: '5b' });
            const [plants, setPlants] = useState([]);
            const [newPlant, setNewPlant] = useState({ 
                name: '', location: LOCATIONS[0], condition: 'Healthy/Mature', notes: '', qty: 1,
                priority: getPriority('Healthy/Mature'), replacement: null, customReplacement: ''
            });
            const [photos, setPhotos] = useState([]);
            const [overallNotes, setOverallNotes] = useState('');
            const [priorities, setPriorities] = useState('');
            const [isGenerating, setIsGenerating] = useState(false);
            const fileInputRef = useRef(null);

            useEffect(() => {
                setTimeout(() => {
                    const loading = document.getElementById('loading');
                    if (loading) loading.style.display = 'none';
                }, 500);
            }, []);

            const handlePhotoUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        setPhotos([...photos, { id: Date.now(), data: event.target.result, location: newPlant.location }]);
                    };
                    reader.readAsDataURL(file);
                }
            };
            
            const addPlant = () => {
                if (!newPlant.name) return;
                const plantData = PLANTS[newPlant.name] || {};
                const priority = getPriority(newPlant.condition);
                const replacement = getReplacementSuggestion(newPlant.name, plantData.type, newPlant.condition);
                
                setPlants([...plants, { 
                    ...newPlant, ...plantData, priority,
                    replacement: newPlant.customReplacement || (replacement ? replacement.primary : null),
                    replacementReason: replacement ? replacement.reason : null,
                    replacementAlternatives: replacement ? replacement.alternatives : null,
                    id: Date.now() 
                }]);
                setNewPlant({ 
                    name: '', location: newPlant.location, condition: 'Healthy/Mature', notes: '', qty: 1,
                    priority: getPriority('Healthy/Mature'), replacement: null, customReplacement: ''
                });
            };
            
            const handleConditionChange = (condition) => {
                const priority = getPriority(condition);
                const plantData = PLANTS[newPlant.name] || {};
                const replacement = getReplacementSuggestion(newPlant.name, plantData.type, condition);
                setNewPlant({ ...newPlant, condition, priority, replacement: replacement ? replacement.primary : null });
            };

            // v4.8: Professional PDF Export
            const exportPDF = async () => {
                setIsGenerating(true);
                try {
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();
                    
                    // Classify all tasks
                    const diyTasks = [];
                    const proTasks = [];
                    const routineTasks = [];
                    
                    plants.forEach(plant => {
                        const classification = classifyTask(plant);
                        if (classification.type === 'diy') diyTasks.push({ ...classification, plant });
                        else if (classification.type === 'professional') proTasks.push({ ...classification, plant });
                        else routineTasks.push({ ...classification, plant });
                    });
                    
                    // Calculate health metrics
                    const criticalCount = plants.filter(p => p.priority.level === 'CRITICAL').length;
                    const highCount = plants.filter(p => p.priority.level === 'HIGH').length;
                    const healthyCount = plants.filter(p => p.priority.level === 'LOW').length;
                    const totalPlants = plants.length;
                    const healthScore = totalPlants > 0 ? Math.round((healthyCount / totalPlants) * 100) : 0;
                    const nativeCount = plants.filter(p => p.native).length;
                    const nativePercent = totalPlants > 0 ? Math.round((nativeCount / totalPlants) * 100) : 0;
                    
                    // =====================
                    // HEADER
                    // =====================
                    doc.setFillColor(22, 163, 74);
                    doc.rect(0, 0, 210, 35, 'F');
                    
                    doc.setFontSize(22);
                    doc.setTextColor(255, 255, 255);
                    doc.setFont(undefined, 'bold');
                    doc.text('Property Assessment Report', 20, 18);
                    
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'normal');
                    doc.text(`${clientInfo.name} | ${clientInfo.address}, ${clientInfo.city}`, 20, 28);
                    doc.text(`Zone ${clientInfo.zone} | ${new Date().toLocaleDateString()}`, 150, 28);
                    
                    let y = 45;
                    
                    // =====================
                    // EXECUTIVE SUMMARY
                    // =====================
                    doc.setFontSize(16);
                    doc.setTextColor(22, 101, 52);
                    doc.setFont(undefined, 'bold');
                    doc.text('Executive Summary', 20, y);
                    y += 10;
                    
                    // Health Assessment Box
                    doc.setFillColor(240, 253, 244);
                    doc.setDrawColor(22, 163, 74);
                    doc.roundedRect(20, y, 170, 35, 3, 3, 'FD');
                    
                    doc.setFontSize(12);
                    doc.setTextColor(0, 0, 0);
                    doc.setFont(undefined, 'bold');
                    doc.text('Overall Landscape Health:', 25, y + 10);
                    
                    // Health score with color coding
                    let healthText = '';
                    let healthColor = [22, 163, 74];
                    if (healthScore >= 70) {
                        healthText = 'Good';
                        healthColor = [22, 163, 74];
                    } else if (healthScore >= 40) {
                        healthText = 'Fair - Some attention needed';
                        healthColor = [202, 138, 4];
                    } else {
                        healthText = 'Needs Attention';
                        healthColor = [220, 38, 38];
                    }
                    
                    doc.setTextColor(...healthColor);
                    doc.text(`${healthScore}% Healthy - ${healthText}`, 95, y + 10);
                    
                    doc.setTextColor(100, 100, 100);
                    doc.setFont(undefined, 'normal');
                    doc.setFontSize(10);
                    doc.text(`${totalPlants} plants documented | ${nativePercent}% Idaho native | ${criticalCount} critical issues`, 25, y + 20);
                    
                    // Quick insight
                    let insight = '';
                    if (criticalCount > 0) {
                        insight = `Immediate attention needed for ${criticalCount} plant(s). Professional assessment recommended.`;
                    } else if (highCount > 0) {
                        insight = `${highCount} items need attention this season. Most can be addressed with routine care.`;
                    } else {
                        insight = 'Your landscape is in good condition. Continue with routine maintenance.';
                    }
                    doc.text(insight, 25, y + 28);
                    
                    y += 45;
                    
                    // =====================
                    // IMMEDIATE ATTENTION (if critical issues exist)
                    // =====================
                    const criticalPlants = plants.filter(p => p.priority.level === 'CRITICAL');
                    
                    if (criticalPlants.length > 0) {
                        doc.setFillColor(254, 242, 242);
                        doc.setDrawColor(220, 38, 38);
                        doc.roundedRect(20, y, 170, 8 + (criticalPlants.length * 18), 3, 3, 'FD');
                        
                        doc.setFontSize(12);
                        doc.setTextColor(220, 38, 38);
                        doc.setFont(undefined, 'bold');
                        doc.text('IMMEDIATE ATTENTION REQUIRED', 25, y + 7);
                        y += 12;
                        
                        doc.setFontSize(10);
                        doc.setFont(undefined, 'normal');
                        
                        criticalPlants.forEach(plant => {
                            doc.setTextColor(0, 0, 0);
                            doc.setFont(undefined, 'bold');
                            doc.text(`${plant.name}`, 25, y + 5);
                            doc.setFont(undefined, 'normal');
                            doc.setTextColor(100, 100, 100);
                            doc.text(`${plant.location} - ${plant.condition}`, 85, y + 5);
                            
                            if (plant.replacement) {
                                y += 5;
                                doc.setTextColor(22, 101, 52);
                                doc.text(`Suggested replacement: ${plant.replacement}`, 30, y + 5);
                            }
                            y += 13;
                        });
                        y += 8;
                    }
                    
                    // =====================
                    // TASK BREAKDOWN
                    // =====================
                    if (y > 200) { doc.addPage(); y = 20; }
                    
                    doc.setFontSize(16);
                    doc.setTextColor(22, 101, 52);
                    doc.setFont(undefined, 'bold');
                    doc.text('Recommended Actions', 20, y);
                    y += 12;
                    
                    // DIY Section
                    if (diyTasks.length > 0) {
                        doc.setFillColor(240, 253, 244);
                        doc.setDrawColor(22, 163, 74);
                        const diyHeight = 12 + (diyTasks.length * 8);
                        doc.roundedRect(20, y, 170, diyHeight, 3, 3, 'FD');
                        
                        doc.setFontSize(11);
                        doc.setTextColor(22, 101, 52);
                        doc.setFont(undefined, 'bold');
                        doc.text('YOU CAN HANDLE', 25, y + 8);
                        
                        const totalDiyTime = diyTasks.reduce((acc, t) => {
                            const match = t.time ? t.time.match(/(\d+)/) : null;
                            return acc + (match ? parseInt(match[1]) : 30);
                        }, 0);
                        doc.setFont(undefined, 'normal');
                        doc.setTextColor(100, 100, 100);
                        doc.text(`Est. ${Math.round(totalDiyTime / 60)}-${Math.round(totalDiyTime / 60) + 1} hours total`, 130, y + 8);
                        
                        y += 14;
                        doc.setFontSize(9);
                        doc.setTextColor(0, 0, 0);
                        
                        diyTasks.forEach(task => {
                            if (y > 275) { doc.addPage(); y = 20; }
                            doc.text(`- ${task.task} (${task.time || '30 min'})`, 28, y);
                            y += 6;
                        });
                        y += 8;
                    }
                    
                    // Professional Section
                    if (proTasks.length > 0) {
                        if (y > 220) { doc.addPage(); y = 20; }
                        
                        doc.setFillColor(254, 249, 195);
                        doc.setDrawColor(202, 138, 4);
                        const proHeight = 12 + (proTasks.length * 12);
                        doc.roundedRect(20, y, 170, proHeight, 3, 3, 'FD');
                        
                        doc.setFontSize(11);
                        doc.setTextColor(161, 98, 7);
                        doc.setFont(undefined, 'bold');
                        doc.text('CONSIDER PROFESSIONAL HELP', 25, y + 8);
                        y += 14;
                        
                        doc.setFontSize(9);
                        doc.setFont(undefined, 'normal');
                        
                        proTasks.forEach(task => {
                            if (y > 275) { doc.addPage(); y = 20; }
                            doc.setTextColor(0, 0, 0);
                            doc.text(`- ${task.task}`, 28, y);
                            y += 4;
                            doc.setTextColor(120, 120, 120);
                            doc.text(`  Reason: ${task.reason}`, 28, y);
                            y += 8;
                        });
                        y += 8;
                    }
                    
                    // Routine maintenance note
                    if (routineTasks.length > 0) {
                        if (y > 250) { doc.addPage(); y = 20; }
                        
                        doc.setFontSize(10);
                        doc.setTextColor(100, 100, 100);
                        doc.setFont(undefined, 'italic');
                        doc.text(`${routineTasks.length} healthy plant(s) require only routine seasonal maintenance.`, 20, y);
                        y += 12;
                    }
                    
                    // =====================
                    // NATIVE PLANT ANALYSIS
                    // =====================
                    if (y > 220) { doc.addPage(); y = 20; }
                    
                    doc.setFontSize(14);
                    doc.setTextColor(22, 101, 52);
                    doc.setFont(undefined, 'bold');
                    doc.text('Native Plant Analysis', 20, y);
                    y += 10;
                    
                    // Draw bar
                    const barWidth = 170;
                    const barHeight = 10;
                    doc.setFillColor(229, 231, 235);
                    doc.roundedRect(20, y, barWidth, barHeight, 2, 2, 'F');
                    
                    const filledWidth = (nativePercent / 100) * barWidth;
                    if (nativePercent >= 40) doc.setFillColor(22, 163, 74);
                    else if (nativePercent >= 20) doc.setFillColor(202, 138, 4);
                    else doc.setFillColor(234, 88, 12);
                    doc.roundedRect(20, y, filledWidth, barHeight, 2, 2, 'F');
                    
                    doc.setFontSize(10);
                    doc.setTextColor(255, 255, 255);
                    doc.setFont(undefined, 'bold');
                    if (filledWidth > 30) doc.text(`${nativePercent}%`, 25, y + 7);
                    
                    y += 15;
                    doc.setTextColor(100, 100, 100);
                    doc.setFont(undefined, 'normal');
                    doc.text(`${nativeCount} native plants | ${totalPlants - nativeCount} adapted species | Treasure Valley avg: 15-20%`, 20, y);
                    y += 12;
                    
                    // =====================
                    // OBSERVATIONS
                    // =====================
                    if (overallNotes) {
                        if (y > 230) { doc.addPage(); y = 20; }
                        
                        doc.setFontSize(14);
                        doc.setTextColor(22, 101, 52);
                        doc.setFont(undefined, 'bold');
                        doc.text('Field Observations', 20, y);
                        y += 8;
                        
                        doc.setFontSize(10);
                        doc.setTextColor(0, 0, 0);
                        doc.setFont(undefined, 'normal');
                        const obsLines = doc.splitTextToSize(overallNotes, 170);
                        obsLines.forEach(line => {
                            if (y > 275) { doc.addPage(); y = 20; }
                            doc.text(line, 20, y);
                            y += 5;
                        });
                        y += 8;
                    }
                    
                    if (priorities) {
                        if (y > 230) { doc.addPage(); y = 20; }
                        
                        doc.setFontSize(14);
                        doc.setTextColor(22, 101, 52);
                        doc.setFont(undefined, 'bold');
                        doc.text('Priority Recommendations', 20, y);
                        y += 8;
                        
                        doc.setFontSize(10);
                        doc.setTextColor(0, 0, 0);
                        doc.setFont(undefined, 'normal');
                        const priLines = doc.splitTextToSize(priorities, 170);
                        priLines.forEach(line => {
                            if (y > 275) { doc.addPage(); y = 20; }
                            doc.text(line, 20, y);
                            y += 5;
                        });
                        y += 8;
                    }
                    
                    // =====================
                    // DETAILED PLANT INVENTORY
                    // =====================
                    doc.addPage();
                    y = 20;
                    
                    doc.setFillColor(22, 163, 74);
                    doc.rect(0, 0, 210, 20, 'F');
                    doc.setFontSize(14);
                    doc.setTextColor(255, 255, 255);
                    doc.setFont(undefined, 'bold');
                    doc.text('Detailed Plant Inventory', 20, 13);
                    
                    y = 30;
                    
                    const priorityOrder = ['CRITICAL', 'HIGH', 'MEDIUM', 'LOW'];
                    const priorityColors = {
                        'CRITICAL': [220, 38, 38],
                        'HIGH': [234, 88, 12],
                        'MEDIUM': [202, 138, 4],
                        'LOW': [22, 163, 74]
                    };
                    
                    priorityOrder.forEach(level => {
                        const levelPlants = plants.filter(p => p.priority.level === level);
                        if (levelPlants.length === 0) return;
                        
                        if (y > 250) { doc.addPage(); y = 20; }
                        
                        doc.setFontSize(12);
                        doc.setTextColor(...priorityColors[level]);
                        doc.setFont(undefined, 'bold');
                        doc.text(`${level} (${levelPlants.length})`, 20, y);
                        y += 8;
                        
                        levelPlants.forEach(plant => {
                            if (y > 265) { doc.addPage(); y = 20; }
                            
                            doc.setFontSize(10);
                            doc.setTextColor(0, 0, 0);
                            doc.setFont(undefined, 'bold');
                            const nativeMarker = plant.native ? ' [Native]' : '';
                            doc.text(`${plant.name}${nativeMarker}`, 25, y);
                            
                            doc.setFont(undefined, 'normal');
                            doc.setTextColor(100, 100, 100);
                            doc.text(`${plant.location} | ${plant.condition}`, 100, y);
                            y += 5;
                            
                            if (plant.replacement) {
                                doc.setTextColor(22, 101, 52);
                                doc.text(`Replacement: ${plant.replacement}`, 30, y);
                                y += 5;
                            }
                            
                            if (plant.notes) {
                                doc.setTextColor(120, 120, 120);
                                const noteLines = doc.splitTextToSize(`Notes: ${plant.notes}`, 155);
                                noteLines.forEach(line => {
                                    doc.text(line, 30, y);
                                    y += 4;
                                });
                            }
                            y += 4;
                        });
                        y += 5;
                    });
                    
                    // =====================
                    // PHOTOS
                    // =====================
                    if (photos.length > 0) {
                        doc.addPage();
                        
                        doc.setFillColor(22, 163, 74);
                        doc.rect(0, 0, 210, 20, 'F');
                        doc.setFontSize(14);
                        doc.setTextColor(255, 255, 255);
                        doc.setFont(undefined, 'bold');
                        doc.text('Photo Documentation', 20, 13);
                        
                        let photoY = 30;
                        
                        for (const photo of photos) {
                            if (photoY > 160) {
                                doc.addPage();
                                photoY = 20;
                            }
                            
                            doc.setFontSize(11);
                            doc.setTextColor(22, 101, 52);
                            doc.setFont(undefined, 'bold');
                            doc.text(photo.location, 20, photoY);
                            photoY += 6;
                            
                            if (photo.notes) {
                                doc.setFontSize(9);
                                doc.setTextColor(100, 100, 100);
                                doc.setFont(undefined, 'normal');
                                doc.text(photo.notes, 20, photoY);
                                photoY += 5;
                            }
                            
                            try {
                                const compressedImg = await compressImage(photo.data, 1200, 0.7);
                                doc.addImage(compressedImg, 'JPEG', 20, photoY, 170, 110);
                                photoY += 118;
                            } catch (err) {
                                doc.setTextColor(200, 0, 0);
                                doc.text('[Image could not be embedded]', 20, photoY);
                                photoY += 10;
                            }
                        }
                    }
                    
                    // =====================
                    // FOOTER ON LAST PAGE
                    // =====================
                    const pageCount = doc.internal.getNumberOfPages();
                    for (let i = 1; i <= pageCount; i++) {
                        doc.setPage(i);
                        doc.setFontSize(8);
                        doc.setTextColor(150, 150, 150);
                        doc.text(`Page ${i} of ${pageCount}`, 105, 290, { align: 'center' });
                    }
                    
                    // Save/Share
                    const pdfBlob = doc.output('blob');
                    const fileName = `${clientInfo.name.replace(/\s+/g, '_')}_Assessment_${new Date().toISOString().split('T')[0]}.pdf`;
                    
                    if (navigator.share && navigator.canShare) {
                        const file = new File([pdfBlob], fileName, { type: 'application/pdf' });
                        if (navigator.canShare({ files: [file] })) {
                            try {
                                await navigator.share({ files: [file] });
                                setIsGenerating(false);
                                return;
                            } catch (err) {
                                if (err.name !== 'AbortError') console.log('Share failed:', err);
                            }
                        }
                    }
                    
                    doc.save(fileName);
                    setIsGenerating(false);
                    
                } catch (err) {
                    setIsGenerating(false);
                    alert('Error generating PDF: ' + err.message);
                }
            };

            // CLIENT INFO STEP
            if (step === 'client') {
                return h('div', { className: 'min-h-screen bg-gradient-to-br from-green-50 to-green-100 flex items-center justify-center p-6' }, [
                    h('div', { key: 'card', className: 'bg-white rounded-2xl shadow-xl p-8 max-w-md w-full' }, [
                        h('div', { key: 'header', className: 'text-center mb-8' }, [
                            h('div', { key: 'icon', className: 'text-6xl mb-4' }, ''),
                            h('h1', { key: 'title', className: 'text-3xl font-bold text-gray-800' }, 'Property Assessment'),
                            h('p', { key: 'subtitle', className: 'text-gray-500 mt-2' }, 'Professional landscaping evaluation'),
                            h('p', { key: 'version', className: 'text-xs text-green-600 mt-2 font-semibold' }, 'v4.8 - Professional Reports')
                        ]),
                        h('div', { key: 'form', className: 'space-y-4' }, [
                            h('div', { key: 'name' }, [
                                h('label', { className: 'block text-sm font-semibold mb-2' }, 'Client Name *'),
                                h('input', { type: 'text', value: clientInfo.name, onChange: e => setClientInfo({ ...clientInfo, name: e.target.value }), className: 'w-full p-3 border rounded-lg', placeholder: 'John Smith' })
                            ]),
                            h('div', { key: 'phone' }, [
                                h('label', { className: 'block text-sm font-semibold mb-2' }, 'Phone'),
                                h('input', { type: 'tel', value: clientInfo.phone, onChange: e => setClientInfo({ ...clientInfo, phone: e.target.value }), className: 'w-full p-3 border rounded-lg', placeholder: '(208) 555-1234' })
                            ]),
                            h('div', { key: 'address' }, [
                                h('label', { className: 'block text-sm font-semibold mb-2' }, 'Street Address *'),
                                h('input', { type: 'text', value: clientInfo.address, onChange: e => setClientInfo({ ...clientInfo, address: e.target.value }), className: 'w-full p-3 border rounded-lg', placeholder: '123 Main Street' })
                            ]),
                            h('div', { key: 'cityzone', className: 'grid grid-cols-2 gap-4' }, [
                                h('div', { key: 'city' }, [
                                    h('label', { className: 'block text-sm font-semibold mb-2' }, 'City'),
                                    h('select', { value: clientInfo.city, onChange: e => setClientInfo({ ...clientInfo, city: e.target.value }), className: 'w-full p-3 border rounded-lg' },
                                        ['Boise', 'Meridian', 'Eagle', 'Nampa', 'Caldwell', 'Garden City', 'Kuna', 'Star', 'Middleton'].map(city => h('option', { key: city, value: city }, city))
                                    )
                                ]),
                                h('div', { key: 'zone' }, [
                                    h('label', { className: 'block text-sm font-semibold mb-2' }, 'Zone'),
                                    h('select', { value: clientInfo.zone, onChange: e => setClientInfo({ ...clientInfo, zone: e.target.value }), className: 'w-full p-3 border rounded-lg' }, [
                                        h('option', { key: '5a', value: '5a' }, '5a (-20F)'),
                                        h('option', { key: '5b', value: '5b' }, '5b (-15F)'),
                                        h('option', { key: '6a', value: '6a' }, '6a (-10F)'),
                                        h('option', { key: '6b', value: '6b' }, '6b (-5F)')
                                    ])
                                ])
                            ]),
                            h('button', { key: 'submit', onClick: () => setStep('assessment'), disabled: !clientInfo.name || !clientInfo.address, className: 'w-full bg-green-600 text-white py-4 rounded-lg font-semibold mt-6 hover:bg-green-700 disabled:bg-gray-300' }, 'Start Assessment')
                        ])
                    ])
                ]);
            }

            // ASSESSMENT STEP
            if (step === 'assessment') {
                const currentReplacement = (() => {
                    const plantData = PLANTS[newPlant.name] || {};
                    return getReplacementSuggestion(newPlant.name, plantData.type, newPlant.condition);
                })();
                
                return h('div', { className: 'min-h-screen bg-gray-50 pb-8' }, [
                    h('div', { key: 'header', className: 'bg-gradient-to-r from-green-600 to-green-700 text-white p-4 shadow-lg' }, [
                        h('div', { key: 'info', className: 'max-w-4xl mx-auto' }, [
                            h('h2', { key: 'name', className: 'font-bold text-lg' }, clientInfo.name),
                            h('p', { key: 'address', className: 'text-green-100 text-sm' }, `${clientInfo.address}, ${clientInfo.city}`)
                        ])
                    ]),
                    
                    h('div', { key: 'photos', className: 'max-w-4xl mx-auto bg-white rounded-lg shadow p-6 mt-6 mx-4' }, [
                        h('h3', { className: 'text-xl font-bold mb-4 flex items-center gap-2' }, [h(Camera, { key: 'icon', size: 24 }), h('span', { key: 'text' }, 'Photos')]),
                        h('input', { type: 'file', accept: 'image/*', capture: 'environment', onChange: handlePhotoUpload, ref: fileInputRef, className: 'hidden' }),
                        h('button', { onClick: () => fileInputRef.current?.click(), className: 'w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 flex items-center justify-center gap-2' }, [h(Camera, { key: 'icon' }), h('span', { key: 'text' }, `Take Photo (${photos.length})`)]),
                        photos.length > 0 && h('div', { key: 'preview', className: 'mt-4 grid grid-cols-3 gap-2' },
                            photos.map(photo => h('div', { key: photo.id, className: 'relative' }, [
                                h('img', { src: photo.data, className: 'w-full h-20 object-cover rounded', alt: photo.location }),
                                h('span', { className: 'absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white text-xs p-1 truncate' }, photo.location)
                            ]))
                        )
                    ]),
                    
                    h('div', { key: 'entry', className: 'max-w-4xl mx-auto bg-white rounded-lg shadow p-6 mt-6 mx-4' }, [
                        h('h3', { className: 'text-xl font-bold mb-4' }, 'Add Plant'),
                        h('div', { className: 'space-y-4' }, [
                            h('div', { key: 'plant-select' }, [
                                h('label', { className: 'block text-sm font-semibold mb-2' }, 'Plant Name'),
                                h('select', { value: newPlant.name, onChange: e => { const name = e.target.value; const plantData = PLANTS[name] || {}; const replacement = getReplacementSuggestion(name, plantData.type, newPlant.condition); setNewPlant({ ...newPlant, name, replacement: replacement ? replacement.primary : null }); }, className: 'w-full p-3 border rounded-lg' }, [
                                    h('option', { key: '', value: '' }, '-- Select Plant --'),
                                    ...Object.keys(PLANTS).sort().map(name => h('option', { key: name, value: name }, `${name}${PLANTS[name].native ? ' *' : ''}`))
                                ])
                            ]),
                            h('div', { key: 'location-cond', className: 'grid grid-cols-2 gap-4' }, [
                                h('div', { key: 'loc' }, [
                                    h('label', { className: 'block text-sm font-semibold mb-2' }, 'Location'),
                                    h('select', { value: newPlant.location, onChange: e => setNewPlant({ ...newPlant, location: e.target.value }), className: 'w-full p-3 border rounded-lg' }, LOCATIONS.map(loc => h('option', { key: loc, value: loc }, loc)))
                                ]),
                                h('div', { key: 'cond' }, [
                                    h('label', { className: 'block text-sm font-semibold mb-2' }, 'Condition'),
                                    h('select', { value: newPlant.condition, onChange: e => handleConditionChange(e.target.value), className: 'w-full p-3 border rounded-lg' }, CONDITIONS.map(cond => h('option', { key: cond, value: cond }, cond)))
                                ])
                            ]),
                            h('div', { key: 'priority', className: 'p-3 rounded-lg text-sm', style: { backgroundColor: newPlant.priority.color + '20', borderLeft: `4px solid ${newPlant.priority.color}` } }, [
                                h('span', { key: 'badge', className: 'font-bold', style: { color: newPlant.priority.color } }, newPlant.priority.level),
                                h('span', { key: 'timeline', className: 'text-gray-600 ml-2' }, `| ${newPlant.priority.timeline}`)
                            ]),
                            currentReplacement && h('div', { key: 'replacement', className: 'p-4 rounded-lg bg-green-50 border-2 border-green-600' }, [
                                h('div', { key: 'header', className: 'flex items-center gap-2 mb-3' }, [
                                    h(AlertCircle, { key: 'icon', size: 20 }),
                                    h('span', { key: 'title', className: 'font-bold text-green-800' }, 'Replacement Recommendation')
                                ]),
                                h('div', { key: 'primary', className: 'mb-3' }, [
                                    h('div', { key: 'value', className: 'font-semibold text-green-700 text-lg' }, currentReplacement.primary),
                                    h('div', { key: 'reason', className: 'text-sm text-gray-600 mt-1' }, currentReplacement.reason)
                                ]),
                                h('div', { key: 'alternatives' }, [
                                    h('select', { key: 'select', value: newPlant.customReplacement || currentReplacement.primary, onChange: e => setNewPlant({ ...newPlant, customReplacement: e.target.value }), className: 'w-full p-2 border rounded mt-1' }, [
                                        h('option', { key: 'primary', value: currentReplacement.primary }, `${currentReplacement.primary} (Recommended)`),
                                        ...currentReplacement.alternatives.map(alt => h('option', { key: alt, value: alt }, alt))
                                    ])
                                ])
                            ]),
                            h('div', { key: 'notes' }, [
                                h('label', { className: 'block text-sm font-semibold mb-2' }, 'Notes'),
                                h('textarea', { value: newPlant.notes || '', onChange: e => setNewPlant({ ...newPlant, notes: e.target.value }), className: 'w-full p-3 border rounded-lg', rows: 2, placeholder: 'Observations...' })
                            ]),
                            h('button', { onClick: addPlant, disabled: !newPlant.name, className: 'w-full bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 disabled:bg-gray-300 flex items-center justify-center gap-2' }, [h(Plus, { key: 'icon' }), h('span', { key: 'text' }, 'Add Plant')])
                        ]),
                        
                        plants.length > 0 && h('div', { key: 'stats', className: 'mt-6 p-4 bg-green-50 border-2 border-green-600 rounded-lg' }, [
                            h('div', { key: 'header', className: 'flex items-center justify-between' }, [
                                h('span', { key: 'label', className: 'text-sm font-semibold text-green-900' }, 'Assessment Progress'),
                                h('span', { key: 'count', className: 'text-2xl font-bold text-green-600' }, `${plants.length} plants`)
                            ]),
                            h('div', { key: 'breakdown', className: 'text-sm text-green-700 mt-2' },
                                `${plants.filter(p => p.native).length} native | ${plants.filter(p => p.priority.level === 'CRITICAL').length} critical | ${plants.filter(p => p.priority.level === 'LOW').length} healthy`
                            )
                        ]),
                        
                        plants.length > 0 && h('div', { key: 'list', className: 'mt-4 space-y-3' },
                            plants.map(plant => h('div', { key: plant.id, className: 'p-4 border rounded-lg bg-gray-50', style: { borderLeft: `4px solid ${plant.priority.color}` } }, [
                                h('div', { key: 'header', className: 'flex justify-between items-start' }, [
                                    h('div', { key: 'name', className: 'font-semibold text-lg flex items-center gap-2 flex-wrap' }, [
                                        h('span', { key: 'text' }, plant.name),
                                        plant.native && h('span', { key: 'native', className: 'text-xs bg-green-600 text-white px-2 py-1 rounded' }, 'Native'),
                                        h('span', { key: 'priority', className: 'text-xs text-white px-2 py-1 rounded', style: { backgroundColor: plant.priority.color } }, plant.priority.level)
                                    ]),
                                    h('div', { key: 'loc', className: 'text-xs text-gray-500' }, plant.location)
                                ]),
                                h('div', { key: 'details', className: 'text-sm text-gray-600 mt-2' }, `${plant.condition} | ${plant.type || 'Unknown type'}`),
                                plant.replacement && h('div', { key: 'replacement', className: 'text-sm text-green-700 mt-2 font-semibold' }, `Replace with: ${plant.replacement}`),
                                plant.notes && h('div', { key: 'notes', className: 'text-sm text-gray-500 mt-1 italic' }, plant.notes)
                            ]))
                        )
                    ]),
                    
                    h('div', { key: 'observations', className: 'max-w-4xl mx-auto bg-white rounded-lg shadow p-6 mt-6 mx-4' }, [
                        h('h3', { className: 'text-xl font-bold mb-4' }, 'Observations'),
                        h('textarea', { value: overallNotes, onChange: e => setOverallNotes(e.target.value), className: 'w-full p-3 border rounded-lg', rows: 3, placeholder: 'Overall landscape observations...' }),
                        h('h3', { className: 'text-xl font-bold mt-4 mb-4' }, 'Recommendations'),
                        h('textarea', { value: priorities, onChange: e => setPriorities(e.target.value), className: 'w-full p-3 border rounded-lg', rows: 3, placeholder: 'Priority recommendations...' })
                    ]),
                    
                    h('div', { key: 'actions', className: 'max-w-4xl mx-auto flex gap-4 mt-6 mx-4' }, [
                        h('button', { key: 'back', onClick: () => setStep('client'), className: 'flex-1 bg-gray-500 text-white py-4 rounded-lg font-semibold hover:bg-gray-600' }, 'Back'),
                        h('button', { key: 'report', onClick: exportPDF, disabled: plants.length === 0 || isGenerating, className: 'flex-1 bg-green-600 text-white py-4 rounded-lg font-semibold hover:bg-green-700 disabled:bg-gray-300 flex items-center justify-center gap-2' },
                            isGenerating ? h('span', { key: 'loading' }, 'Generating...') : [h(Share, { key: 'icon' }), h('span', { key: 'text' }, 'Generate Report')]
                        )
                    ])
                ]);
            }
        }

        ReactDOM.render(React.createElement(App), document.getElementById('root'));
    </script>
</body>
</html>
